<html>
  <head>
      <link href = "bootstrap-3.3.7-dist\css\bootstrap.min.css" rel = "stylesheet" />
      <link href = "css\style.css" rel = "stylesheet" />
  </head>

  <body>
    <br>
      <div class = "container-fluid">

        <div class = "row">
          <div class = "col-lg-7">


                    <div class = "row">

                      <div class = "col-md-2">
                        <label for="listPlayers">Players</label>
                        <ul class="list-group list-special" id ="listPlayers">
                        </ul>


                      </div>

                      <div class = "col-md-10">

                        <label for="txtAreaGame">Game</label>
                        <textarea class="form-control" id="txtAreaGame" rows="3"></textarea>
                        <div class = "input-group">
                          <input type = "text" class = "form-control" id = "txtGame">
                          <div class = "input-group-btn">
                            <button type="submit" class="btn btn-primary" id = "btnGame">Send</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <form>
                      <div class="form-group">
                        <label for="exampleTextarea">Social/Game Activity</label>
                        <textarea class="form-control" id="exampleTextarea" rows="3" value = "test" disabled></textarea>

                        <div class = "input-group">
                          <input type = "text" class = "form-control" id = "txtChat">
                          <div class = "input-group-btn">
                            <button type="submit" class="btn btn-primary" id = "btnChat">Send</button>
                          </div>

                        </div>
                        <label id = "lblUsername">Your username: </label>

                      </div>

                    </form>

                  </div>


                  <div class = "col-lg-5">
                    <canvas id = "c" width = "800" height = "800" style = "border:1px solid #ffffff"></canvas>
                    <!--canvas id = "c2" width = "800" height = "800" style = "border:1px solid #ffffff"></canvas-->
					<button class = "btn btn-default" id = "btnClearCanvas">Clear</button>
                  </div>
          </div>
        </div>


  </body>
  <script src = "socket.io/socket.io.js"></script>
  <script src = "jquery-3.1.1.js"></script>
  <script src = "fabric.js"></script>
  <script src = "canvas.js"></script>

  <script>

    var socket = io();
    var userName = prompt("Welcome! Enter your name: ", "guest_user");
    var userLabel = document.getElementById('lblUsername');

    userLabel.innerHTML = "Your username:  " + userName;
    var userNameToChat = userLabel.innerHTML.slice(15, userLabel.length)

	socket.on('user_joined', function(msg){
		$('#exampleTextarea').append(msg + '\n')
	});
	
	socket.on('user_left', function(msg){
		$('#exampleTextarea').append(msg + '\n')
	});
	
    socket.on('chat message',function (msg){
      $('#exampleTextarea').append(msg + '\n');
    });
		
	
	socket.on('del_user', function(name){
		refreshPlayerList(name);
	})
	
	socket.on('add_user', function(name){
		refreshPlayerList(name);
	});
	

	socket.on('draw', function(data){
		canvas.loadFromJSON(data);
		canvas.renderAll();
	});
	
	socket.emit('user_joined', "[Server]" + userNameToChat + " has joined the game!");
	socket.emit('add_user', userNameToChat);

	$(window).on('beforeunload', function(){
        socket.emit('del_user', userNameToChat);
		socket.emit('user_left', "[Server]" + userNameToChat + " has left the game.")
    });
	
    $('form').submit(function(){
      socket.emit('chat message', updateTime() + $('#txtChat').val());
      $('#txtChat').val('');
      return false;
    });


	canvas.observe('mouse:up', function(){
		console.log('mouse up');
		socket.emit('draw', JSON.stringify(canvas));
	});
	
	function updateTime(){
      var date = new Date();
      var time = date.toLocaleTimeString();
      var message = "[" + time + "]" + userNameToChat + ": ";
      return message;
    }

	
	function refreshPlayerList(name){
		$('.list-group-item').remove();
		
		for(var i = 0; i < name.length; i++){
			$('#listPlayers').append($('<li class = "list-group-item">').text(name[i]));
		}
	}
	
  </script>

</html>
